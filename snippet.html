<!-- Matomo -->
<script>
  var _paq = (window._paq =
    window._paq ||
    []); /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);
  (function () {
    var u = "https://ew.dataprev.gov.br/";
    _paq.push(["setTrackerUrl", u + "matomo.php"]);
    _paq.push(["setSiteId", "18"]);
    var d = document,
      g = d.createElement("script"),
      s = d.getElementsByTagName("script")[0];
    g.async = true;
    g.src = u + "matomo.js";
    s.parentNode.insertBefore(g, s);
  })();
</script>
<!-- End Matomo Code -->

<script defer>
  (() => {
    window.addEventListener("DOMContentLoaded", (e) => {
      ImportScriptFile();
      CreateDOMObjects();

      // Evento para primeira letra maiuscula
      capitalizarOnBlur("proposal_title");
      capitalizarOnBlur("proposal_body");

      definirUrlLogOut();

      showCreateProfileLink();
      removeSecondProductionLogin();

      removeBPMenu();

      updateContentMarginTop();
      convertIconsToHttps();
      window.addEventListener("resize", updateContentMarginTop);

      doEverything();
    });
  })();

  const removeBPMenu = () => {
    if (window.location.pathname.includes("/processes/brasilparticipativo")) {
      const processHeader = document.querySelector(".process-header");
      if (processHeader) {
        processHeader.remove();
      }
    }
  }

  const convertIconsToHttps = () => {
    const icons = document.querySelectorAll("link");
    icons.forEach((icon) => {
      if (icon.src.includes("http://")) {
        icon.src = icon.src.replace("http://", "https://");
      }
    });
  }

  // --------------------------- vlibras ---------------------------
  var CreateDOMObjects = () => {
    const DOM = `
      <div vw class="enabled">
      <div vw-access-button class="active"></div>
      <div vw-plugin-wrapper>
        <div class="vw-plugin-top-wrapper"></div>
      </div>
      </div>
    `;
    document.body.insertAdjacentHTML("beforeend", DOM);

    var elAcessButton = document.querySelector("div[vw-access-button]");
    var elPLuginWrapper = document.querySelector("div[vw-plugin-wrapper]");

    elAcessButton.addEventListener(
      "click",
      function () {
        if (!elPLuginWrapper.classList.contains("active")) {
          elPLuginWrapper.classList.add("active");
          elAcessButton.classList.remove("active");

          //close
          var elSettingClose = document.querySelector(
            ".vpw-settings-btn-close"
          );

          $("div[vw]").on("click", ".vpw-settings-btn-close", function (event) {
            elPLuginWrapper.classList.remove("active");
            elAcessButton.classList.add("active");
          });
        }
      },
      false
    );
  };

  var ImportScriptFile = () => {
    let script = document.createElement("script");
    script.src = "https://vlibras.gov.br/app/vlibras-plugin.js";
    script.onload = () => {
      new window.VLibras.Widget("https://vlibras.gov.br/app");
    };
    document.body.appendChild(script);
  };

  // --------------------------- capitalizar ---------------------------

  function capitalizarOnBlur(elementId) {
    let element = document.getElementById(elementId);
    if (element != undefined && element != null) {
      element.onblur = function () {
        capitalizar(element);
      };
    }
  }
  function capitalizar(input) {
    if (input.value.length > 0) {
      input.value = input.value.charAt(0).toUpperCase() + input.value.slice(1);
    }
  }

  // --------------------------- logout ---------------------------

  function definirUrlLogOut() {
    var logOutUrl;
    var hostname = window.location.hostname;

    if (hostname.endsWith(".presidencia.gov.br")) {
      logOutUrl =
        "https://sso.acesso.gov.br/logout?post_logout_redirect_uri=https://" +
        hostname +
        "/users/sign_out";
    } else {
      logOutUrl =
        "https://sso.staging.acesso.gov.br/logout?post_logout_redirect_uri=https://" +
        hostname +
        "/users/sign_out";
    }

    var link = $(".sign-out-link");

    if (link && link.length > 0) {
      link.removeAttr("data-method");
      link.attr("href", "#");
      link.on("click", function () {
        window.location.href = logOutUrl;
      });
    }
  }

  // --------------------------- create profile link---------------------------
  
  function showCreateProfileLink() {
    const loginButton = document.querySelector(
      ".sign-in-button .br-sign-in span"
    );
    if (!loginButton) {
      const link = document.getElementById("create-profile-container");
      if (link) link.remove();
    }
  }

  // --------------------------- remove second login ---------------------------

  function removeSecondProductionLogin() {
    if (
      window.location.href ===
      "https://brasilparticipativo.presidencia.gov.br/users/sign_in"
    ) {
      const cardContent = document.querySelector(".card__content");
      const registerSeparator = document.querySelector(".register__separator");
      const loginText = document.querySelector(
        ".columns.large-8.large-centered.text-center.page-title p"
      );
      const shadowRow = document.querySelector(
        ".columns.large-6.medium-centered"
      );

      if (shadowRow) shadowRow.remove();
      if (cardContent) cardContent.remove();
      if (loginText) loginText.remove();
      if (registerSeparator) registerSeparator.remove();
    }
  }

  // --------------------------- content margin top ---------------------------
  function updateContentMarginTop() {
    const header = document.querySelector("#br-header");
    const menu = document.querySelector("#process-nav-content");
    const content = document.querySelector("#content");
    if (header) {
      if (content) {
        content.style.marginTop = header.offsetHeight - 2 + "px";
      }
      if (menu && content) {
        menu.style.top = header.offsetHeight - 2 + "px";
      }
    }
  }

  // --------------- doEverything ----------------
  function doEverything() {


    const createTabItem = (name, path) => {
      const li = document.createElement("li");
      li.classList.add("tab-item");

      const a = document.createElement("a");
      a.setAttribute("href", path);
      a.textContent = name;

      const isActive = name === "Início" && window.location.pathname === path;
      li.classList.toggle("active", isActive);

      li.appendChild(a);
      return li;
    };

    const removeElement = (element) => element.parentNode.removeChild(element);
    const navbarUl = document.querySelector(".process-nav ul");

    if (window.location.pathname === "/amends/new") {
      const title_form = document.querySelector(
        'label[for="amendment_emendation_params_title"]'
      );
      if (title_form) {
        title_form.remove();
      }
    }
    if (navbarUl) {
      if (window.location.pathname === "/assemblies/mercosulsocial") {
        var imgElement = document.createElement("img");
        imgElement.src =
          "https://brasilparticipativo.presidencia.gov.br/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBBdUJUIiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--ab7ba193c3d5b5145861d9228d18bd7cd3ea5bc2/mercosul_img.jpeg";
        imgElement.alt = "Mercosul Banner";

        var containerDiv = document.createElement("div");
        containerDiv.classList.add("br-container-lg");

        containerDiv.style.marginBottom = "32px";
        containerDiv.style.display = "flex";
        containerDiv.style.justifyContent = "center";

        containerDiv.appendChild(imgElement);

        var wrapperElement = document.querySelector(".wrapper");

        if (wrapperElement) {
          wrapperElement.insertBefore(containerDiv, wrapperElement.firstChild);
        } else {
          console.error("Elemento wrapper não encontrado.");
        }

        const images = document.querySelector(".section.images");
        images.remove();
        const menu_nav = document.querySelector(".process-nav");
        if (menu_nav) {
          menu_nav.remove();
        }
      } else if (window.location.href.includes("/processes/ENGD")) {
        var allElements = document.querySelectorAll("*:not(script):not(style)");
        var respond_comment_button = document.querySelectorAll(
          ".comment__reply.muted-link"
        );
        respond_comment_button.forEach((btn) => btn.remove());

        respond_comment_button.forEach((btn) => btn.remove());

        var opinionToggleButton = document.querySelector(".opinion-toggle");
        if (opinionToggleButton) {
          opinionToggleButton.remove();
        }

        var indiceButton = document.querySelector(".see-index-container");
        if (indiceButton) {
          indiceButton.remove();
        }

        var targetNodes = document.querySelectorAll(".comments");

        if (targetNodes.length) {
          var config = {
            childList: true,
            subtree: true,
            characterData: true,
            attributes: true,
          };
          var observers = [];

          targetNodes.forEach(function (targetNode) {
            var observer = new MutationObserver(function (mutations) {
              mutations.forEach(function (mutation) {
                var respondCommentButtons = targetNode.querySelectorAll(
                  ".comment__reply.muted-link"
                );
                if (respondCommentButtons.length) {
                  respondCommentButtons.forEach((btn) => btn.remove());
                }
                var voteCommentButton =
                  targetNode.querySelectorAll(".comment__footer");
                if (voteCommentButton.length) {
                  voteCommentButton.forEach((btn) => btn.remove());
                }
              });
            });

            observer.observe(targetNode, config);
            observers.push(observer);
          });
        }

        // Função para substituir o texto em um elemento
        function replaceText(node) {
          if (node.nodeType === Node.TEXT_NODE) {
            node.textContent = node.textContent.replace(
              /propostas/g,
              "recomendações"
            );
            node.textContent = node.textContent.replace(
              /proposta/g,
              "recomendação"
            );
            node.textContent = node.textContent.replace(
              /Propostas/g,
              "Recomendações"
            );
            node.textContent = node.textContent.replace(
              /Proposta/g,
              "Recomendação"
            );
          }
        }

        // Itera sobre todos os elementos de texto e substitui o conteúdo
        for (var i = 0; i < allElements.length; i++) {
          var walker = document.createTreeWalker(
            allElements[i],
            NodeFilter.SHOW_TEXT,
            null,
            false
          );
          var node;

          while ((node = walker.nextNode())) {
            replaceText(node);
          }
        }

        const elements = document.querySelectorAll(
          ".callout.alert.callout--full"
        );

        elements.forEach((element) => {
          if (element.textContent.includes("Este é um processo privado")) {
            element.remove();
          }
        });

        const homeSections = document.querySelectorAll(
          ".section.row.collapse.highlighted_proposals"
        );
        homeSections.forEach((section) => {
          section.remove();
        });

        const spaceMenu = navbarUl.querySelectorAll("li");

        if (spaceMenu.length) {
          spaceMenu.forEach((liElement) => {
            liElement.remove();
          });
        }

        navbarUl.appendChild(createTabItem("Início", "/processes/ENGD"));
        navbarUl.appendChild(createTabItem("Decreto", `/processes/ENGD/f/77`));
        navbarUl.appendChild(
          createTabItem("Recomendações", `/processes/ENGD/f/67`)
        );

        if (window.location.href.includes("/processes/ENGD/f/67")) {
          const filters = document.querySelector(".filters");

          if (filters) {
            filters.style.maxWidth = "500px";
          }
        }

        if (window.location.href.includes("/processes/ENGD/f/77")) {
          const participatoryList = document.querySelector(
            ".participatory-text-list"
          );

          if (participatoryList) {
            const participatoryItems = participatoryList.querySelectorAll(
              ".participatory-text-item"
            );

            participatoryItems.forEach((item) => {
              const textItems = item.querySelector("a");
              const firstTextItem = textItems.firstElementChild;

              if (
                firstTextItem &&
                (firstTextItem.textContent.startsWith("CAPÍTULO") ||
                  firstTextItem.textContent.startsWith("Seção"))
              ) {
                const itemActionsDiv = item.querySelector(".item-actions");
                itemActionsDiv.remove();

                const newDiv = document.createElement("div");
                newDiv.innerHTML = textItems.innerHTML;
                newDiv.style = textItems.style;
                textItems.parentNode.replaceChild(newDiv, textItems);

                item.style.pointerEvents = "none";
              }
            });
          }
        }
      }
    }

    const programContentContainer =
      document.querySelector(".ql-editor-display");
    const url = window.location.href;
    const linkToAllPrograms = document.createElement("p");
    linkToAllPrograms.innerHTML =
      'Conheça os <a href="/pages/lista_de_programas"><strong>90 programas</strong></a> dos ministérios.</p>';
    if (url.includes(`/processes/programas/f/1/`) && programContentContainer) {
      programContentContainer.appendChild(linkToAllPrograms);
    }

    const urlProgram = window.location.href;
    const oldLink = document.querySelector(".ql-editor-display a");
    if (
      oldLink &&
      urlProgram.includes(`/processes/programas/f/1/proposals/43`)
    ) {
      var newLink = document.createElement("a");
      newLink.id = "id-new-link";
      newLink.href = "/link?external_url=https://www.gov.br/mda/pt-br";
      newLink.textContent = "https://www.gov.br/mda/pt-br";
      oldLink.parentNode.replaceChild(newLink, oldLink);
    }
    const loginButton = document.querySelector(
      "a.button--govbr span.button--social__text"
    );
    if (loginButton) {
      loginButton.innerHTML = "Entrar com <strong>gov.br</strong>";
    }
  }

  function convertIconsToHttps() {
    const icons = document.querySelectorAll("link");
    icons.forEach((icon) => {
      if (icon.src.includes("http://")) {
        icon.src = icon.src.replace("http://", "https://");
      }
    });
  }
</script>

<style type="text/css">
  .card__author {
    display: none;
  }

  .row.collapse.buttons__row {
    display: none;
  }

  .results-per-page__dropdown {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
  }

  .see-index-container {
    justify-content: flex-start;
  }

  .tab-item a span {
    font-size: 16px;
  }

  .process-nav ul {
    justify-content: flex-start !important;
  }
</style>
